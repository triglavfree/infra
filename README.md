#  INFRA - GitOps-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –¥–æ–º–∞—à–Ω–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

> **v4.1** ‚Ä¢ Quadlets + Podman + systemd + –∞–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ  
> –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã ‚Äî `infra.sh`  
> –•–æ—Å—Ç ‚Äî —Ç–æ–ª—å–∫–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞, –Ω–µ –æ–±—ä–µ–∫—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏  
> –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö ‚Ä¢ –î–∞–Ω–Ω—ã–µ –ª–µ–≥–∫–æ –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è ‚Ä¢ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞ 5 –º–∏–Ω—É—Ç
---
### üß± –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```txt
–•–æ—Å—Ç (Ubuntu Server 24.04)
 ‚îî‚îÄ‚îÄ Podman + Quadlet (systemd --user)
      ‚îú‚îÄ‚îÄ Gitea + Actions Runner   ‚Üê Git-—Å–µ—Ä–≤–µ—Ä + CI/CD
      ‚îú‚îÄ‚îÄ Vaultwarden              ‚Üê –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–∞—Ä–æ–ª–µ–π (Bitwarden-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π)
      ‚îú‚îÄ‚îÄ TorrServer               ‚Üê –°—Ç—Ä–∏–º–∏–Ω–≥ —Ç–æ—Ä—Ä–µ–Ω—Ç–æ–≤
      ‚îú‚îÄ‚îÄ AdGuard Home             ‚Üê –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ä–µ–∫–ª–∞–º—ã –∏ DNS-—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
      ‚îú‚îÄ‚îÄ Caddy                    ‚Üê Reverse proxy + –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π HTTPS
      ‚îú‚îÄ‚îÄ Dozzle                   ‚Üê –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
      ‚îú‚îÄ‚îÄ WireGuard                ‚Üê VPN-—Å–µ—Ä–≤–µ—Ä –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
      ‚îî‚îÄ‚îÄ Restic                   ‚Üê –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–ª–∞—á–Ω—ã–µ –±—ç–∫–∞–ø—ã
```
### üîë –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

|–ü—Ä–∏–Ω—Ü–∏–ø|–†–µ–∞–ª–∏–∑–∞—Ü–∏—è|
|:---|:---|
|–•–æ—Å—Ç –Ω–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è|–°–∫—Ä–∏–ø—Ç—ã —Ç–æ–ª—å–∫–æ –≥–æ—Ç–æ–≤—è—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—É (–ø–∞–∫–µ—Ç—ã, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏), –Ω–µ —Ç—Ä–æ–≥–∞—é—Ç `/etc` —Å–µ—Ä–≤–∏—Å–æ–≤|
|Disposable-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã|–õ—é–±–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å ‚Äî –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `~/infra/volumes/`|
|–ê–≤—Ç–æ–Ω–æ–º–Ω–æ–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ|–û–¥–∏–Ω —Ñ–∞–π–ª `infra.sh` —Å —Ñ–ª–µ—à–∫–∏ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–µ—Ç –≤—Å—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞|
|–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é|–ü–∞—Ä–æ–ª–∏ –≤ SSH –æ—Ç–∫–ª—é—á–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–ª—é—á–µ–π, UFW + Fail2Ban, WireGuard VPN|
|–ú–∏–Ω–∏–º–∞–ª–∏–∑–º|–¢–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã –±–µ–∑ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ –∏ –ø—Ä–æ–ø—Ä–∏–µ—Ç–∞—Ä–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤|

### üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```txt
infra/
‚îú‚îÄ‚îÄ bootstrap/
‚îÇ   ‚îú‚îÄ‚îÄ bootstrap.sh                # –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ö–æ—Å—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ common.sh                   # –¶–≤–µ—Ç–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ bin/
‚îÇ   ‚îî‚îÄ‚îÄ infra                       # –ï–¥–∏–Ω–∞—è CLI: infra install|backup|restore|status|logs
‚îú‚îÄ‚îÄ containers/
‚îÇ   ‚îú‚îÄ‚îÄ caddy.container             # Reverse proxy + HTTPS (–ø–æ—Ä—Ç—ã 80/443)
‚îÇ   ‚îú‚îÄ‚îÄ gitea.container             # Git-—Å–µ—Ä–≤–µ—Ä —Å –≤–∫–ª—é—á—ë–Ω–Ω—ã–º–∏ Actions (–ø–æ—Ä—Ç 3000)
‚îÇ   ‚îú‚îÄ‚îÄ gitea-runner.container      # CI/CD —Ä–∞–Ω–Ω–µ—Ä –¥–ª—è Gitea Actions
‚îÇ   ‚îú‚îÄ‚îÄ vaultwarden.container       # –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–∞—Ä–æ–ª–µ–π (Rust, –±–µ–∑ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏) (–ø–æ—Ä—Ç 8081)
‚îÇ   ‚îú‚îÄ‚îÄ torrserver.container        # –°—Ç—Ä–∏–º–∏–Ω–≥ —Ç–æ—Ä—Ä–µ–Ω—Ç–æ–≤ (ghcr.io/yourok/torrserver) (–ø–æ—Ä—Ç 8090)
‚îÇ   ‚îú‚îÄ‚îÄ adguardhome.container       # –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ä–µ–∫–ª–∞–º—ã –∏ DNS-—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è (–ø–æ—Ä—Ç 3001, 53/UDP)
‚îÇ   ‚îú‚îÄ‚îÄ dozzle.container            # –õ–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å podman.sock) (–ø–æ—Ä—Ç 9999)
‚îÇ   ‚îú‚îÄ‚îÄ restic.container            # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–ª–∞—á–Ω—ã–µ –±—ç–∫–∞–ø—ã (—Ç–∞–π–º–µ—Ä systemd)
‚îÇ   ‚îî‚îÄ‚îÄ restic.timer                # –¢–∞–π–º–µ—Ä –¥–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –±—ç–∫–∞–ø–æ–≤
‚îú‚îÄ‚îÄ volumes/                        # –î–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å–æ–≤:
‚îÇ   ‚îú‚îÄ‚îÄ caddy/                      # TLS-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ gitea/                      # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ + –ë–î SQLite
‚îÇ   ‚îú‚îÄ‚îÄ gitea-runner/               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä–∞–Ω–Ω–µ—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ vaultwarden/                # –ë–∞–∑–∞ –ø–∞—Ä–æ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ torrserver/                 # –¢–æ—Ä—Ä–µ–Ω—Ç—ã + –º–µ–¥–∏–∞-–∫—ç—à
‚îÇ   ‚îú‚îÄ‚îÄ adguardhome/                # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è AdGuard Home
‚îÇ   ‚îî‚îÄ‚îÄ restic/                     # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Restic –¥–ª—è –±—ç–∫–∞–ø–æ–≤
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îî‚îÄ‚îÄ recovery.md                 # –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å –Ω—É–ª—è
‚îú‚îÄ‚îÄ secrets/                        # –°–µ–∫—Ä–µ—Ç—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (700 –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞)
‚îú‚îÄ‚îÄ backups/                        # –ó–ê–®–ò–§–†–û–í–ê–ù–ù–´–ï –ë–≠–ö–ê–ü–´ (—Ç–æ–ª—å–∫–æ .tar.gz.gpg —Ñ–∞–π–ª—ã)
‚îÇ   ‚îî‚îÄ‚îÄ infra-backup.tar.gz.gpg     # –ü—Ä–∏–º–µ—Ä –∞—Ä—Ö–∏–≤–∞
‚îú‚îÄ‚îÄ logs/                           # –õ–æ–≥–∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ README.md                       # –°–ø—Ä–∞–≤–∫–∞
‚îî‚îÄ‚îÄ LICENSE                         # MIT ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫—Ä—ã—Ç—ã–π —à–∞–±–ª–æ–Ω
```
### ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–∞–≤—Ç–æ–Ω–æ–º–Ω–æ–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å —Ñ–ª–µ—à–∫–∏)

<details>
<summary>–û—Ç–∫–ª—é—á–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –∫—Ä—ã—à–∫–∏ –Ω–æ—É—Ç–±—É–∫–∞ –Ω–∞ Ubuntu Server</summary>

1. –°–æ–∑–¥–∞–π—Ç–µ –∏–ª–∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```bash
sudo nano /etc/systemd/logind.conf
```

2. –ù–∞–π–¥–∏—Ç–µ –∏ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫–∏

```txt
[Login]
# –ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –∫—Ä—ã—à–∫–∏ –Ω–∞ –±–∞—Ç–∞—Ä–µ–µ - –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—Ç—å
HandleLidSwitch=ignore
# –ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –∫—Ä—ã—à–∫–∏ —Å –ø–∏—Ç–∞–Ω–∏–µ–º –æ—Ç —Å–µ—Ç–∏ - –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—Ç—å
HandleLidSwitchExternalPower=ignore
# –ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –∫—Ä—ã—à–∫–∏ –≤ –¥–æ–∫-—Å—Ç–∞–Ω—Ü–∏–∏ - –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—Ç—å
HandleLidSwitchDocked=ignore
# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É —Å–µ—Å—Å–∏–∏ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
LidSwitchIgnoreInhibited=yes
```
3. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å–ª—É–∂–±—É:
```bash
sudo systemctl restart systemd-logind
```
</details>

<details>
<summary>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–≥–æ SSH-–∫–ª—é—á–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä</summary>

   - –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å–æ–∑–¥–∞–π—Ç–µ/–æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ authorized_keys
```bash
mkdir -p ~/.ssh && nano ~/.ssh/authorized_keys
```
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞
```bash
chmod 700 ~/.ssh && chmod 600 ~/.ssh/authorized_keys && sudo service ssh reload
```
</details>

<details>

<summary>–ü–æ–¥–∫–ª—é—á–∏—Ç–µ —Ñ–ª–µ—à–∫—É:</summary>

```bash
lsblk
```
- –°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É –¥–ª—è –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–µ—Å–ª–∏ –µ–µ –Ω–µ—Ç) –∏ —Å–º–æ–Ω—Ç–∏—Ä—É–π—Ç–µ —Ñ–ª–µ—à–∫—É:
```bash
sudo mkdir -p /mnt/usb
```
- (–ó–∞–º–µ–Ω–∏—Ç–µ /dev/sdb –Ω–∞ –≤–∞—à–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏–∑ –ø.1).
```bash
sudo mount /dev/sdb /mnt/usb
```
- –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏ —Å —Å–æ–¥–µ—Ä–∂–∏–º—ã–º (—Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ) –≤ –¥–æ–º–∞—à–Ω—é—é –ø–∞–ø–∫—É:
```bash
cp -r /mnt/usb/* ~/
```
- –û—Ç–º–æ–Ω—Ç–∏—Ä—É–π—Ç–µ —Ñ–ª–µ—à–∫—É –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:
```bash
sudo umount /mnt/usb
```
</details>

1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É –ø–æ SSH –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç —Å —Ñ–ª–µ—à–∫–∏ (–ø—Ä–∏–º–µ—Ä –¥–ª—è /media/usb)
```bash
cp /media/usb/infra.sh ~/
chmod +x infra.sh
```
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ üöÄ
```bash
./infra.sh
```
### –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

- –°–æ–∑–¥–∞—Å—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É `~/infra/` —Å–æ –≤—Å–µ–º–∏ –∫–∞—Ç–∞–ª–æ–≥–∞–º–∏
- –ó–∞–ø—É—Å—Ç–∏—Ç sudo `~/infra/bootstrap/bootstrap.sh` –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ö–æ—Å—Ç–∞:
- –û–±–Ω–æ–≤–∏—Ç —Å–∏—Å—Ç–µ–º—É
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç `Podman`, `UFW`, `Fail2Ban`, `WireGuard`
- –ù–∞—Å—Ç—Ä–æ–∏—Ç `BBR`, `swap`, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é `SSD/NVMe`
>üí° Swap –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–±—ä—ë–º–∞ RAM:\
> - ‚â§ 1 –ì–ë ‚Üí 2 –ì–ë swap
> - ‚â§ 2 –ì–ë ‚Üí 1 –ì–ë swap
> - ‚â§ 4 –ì–ë ‚Üí 512 –ú–ë swap
> - 4 –ì–ë ‚Üí 512 –ú–ë swap
- –°–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–ª—é—á–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç `WireGuard` (–ø–æ—Ä—Ç 51820/UDP)
- –û—Ç–∫–ª—é—á–∏—Ç –ø–∞—Ä–æ–ª–∏ –≤ SSH (—Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–ª—é—á–µ–π!)
- –í–∫–ª—é—á–∏—Ç `linger` –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
- –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç `podman-auto-update.timer` –¥–ª—è –∞–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —á–µ—Ä–µ–∑ `Quadlet`
- –ó–∞–ø—É—Å—Ç–∏—Ç –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã (–∫—Ä–æ–º–µ Gitea-—Ä–∞–Ω–Ω–µ—Ä–∞)
- –î–æ–∂–¥—ë—Ç—Å—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ Gitea –∏ –ø–æ–∫–∞–∂–µ—Ç —Å—Å—ã–ª–∫—É –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–¥–º–∏–Ω–∞
- –ó–∞–ø—Ä–æ—Å–∏—Ç —Ç–æ–∫–µ–Ω —Ä–∞–Ω–Ω–µ—Ä–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç –µ–≥–æ
- –ù–∞—Å—Ç—Ä–æ–∏—Ç `healthcheck` —á–µ—Ä–µ–∑ `cron` (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)
- –ü–æ–∫–∞–∂–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç —Å –ø–æ—Ä—Ç–∞–º–∏ –∏ –∫–æ–º–∞–Ω–¥–∞–º–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### üîê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π

```bash
# –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
infra status

# –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø (—Ç–æ–º–∞ + –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã)
infra backup

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±—ç–∫–∞–ø–∞
infra restore

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏
infra update status     # –°—Ç–∞—Ç—É—Å —Ç–∞–π–º–µ—Ä–∞ –∏ –ª–æ–≥–∏
infra update run        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π (dry-run)
infra update apply      # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
infra monitor

# –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
infra logs gitea
infra logs torrserver

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏
infra start             # –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
infra stop              # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
systemctl --user restart gitea.service
```
> üí° –ö–æ–º–∞–Ω–¥–∞ `infra` –¥–æ—Å—Ç—É–ø–Ω–∞ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è (–¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `~/.bashrc`).

### ü©∫ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–∫–ª—é—á–∞–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º healthcheck, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç —á–µ—Ä–µ–∑ `cron`:

- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤—Å–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (Gitea, Vaultwarden, AdGuard Home, TorrServer)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–µ—Ç–µ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (WireGuard, SSH)
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram –ø—Ä–∏ —Å–±–æ—è—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- –õ–æ–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ `~/infra/logs/healthcheck.log`

–î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∑–∞–¥–∞–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```bash
export TELEGRAM_BOT_TOKEN="–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞"
export TELEGRAM_CHAT_ID="–≤–∞—à_chat_id"
```

### üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ 
```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —á–∏—Å—Ç—ã–π Ubuntu Server 24.04

# 2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å —Ñ–ª–µ—à–∫–∏:
#    ‚Ä¢ infra.sh
#    ‚Ä¢ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π –∞—Ä—Ö–∏–≤: infra-backup-*.tar.gz.gpg
# 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –ë–ï–ó –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
./infra.sh --restore
# 4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∞—Ä—Ö–∏–≤ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –±—ç–∫–∞–ø–æ–≤
cp /media/usb/infra-backup-*.tar.gz.gpg ~/infra/backups/
# 5. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ (–∑–∞–ø—Ä–æ—Å–∏—Ç –ø–∞—Ä–æ–ª—å)
infra restore
# 6. –°–µ—Ä–≤–∏—Å—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç—è—Ç—Å—è –ø–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
```

> üí° –ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:
> - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å: `infra status`
> - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç: `infra monitor`
> - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –æ–±–ª–∞—á–Ω—ã–µ –±—ç–∫–∞–ø—ã (Restic) –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å:
>   1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –≤ `~/infra/secrets/restic/`
>   2. –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ —Ç–∞–π–º–µ—Ä: `systemctl --user enable --now restic.timer`
> - Healthcheck –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω —á–µ—Ä–µ–∑ cron (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ: `crontab -l`)
### üîê C—Ö–µ–º–∞ –±—ç–∫–∞–ø–æ–≤
```txt
infra-backup-20260205-143022.tar.gz.gpg
‚îî‚îÄ‚îÄ volumes/
    ‚îú‚îÄ‚îÄ gitea/               # ‚Üê –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ Git + –ë–î SQLite + –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    ‚îú‚îÄ‚îÄ gitea-runner/        # ‚Üê –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä–∞–Ω–Ω–µ—Ä–∞ + —Ç–æ–∫–µ–Ω —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
    ‚îú‚îÄ‚îÄ vaultwarden/         # ‚Üê –ë–∞–∑–∞ –ø–∞—Ä–æ–ª–µ–π (—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–∞—è) + –∫–ª—é—á–∏
    ‚îú‚îÄ‚îÄ adguardhome/         # ‚Üê –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è AdGuard Home
    ‚îú‚îÄ‚îÄ torrserver/          # ‚Üê .torrent —Ñ–∞–π–ª—ã + –º–µ–¥–∏–∞-–∫—ç—à + –±–∞–∑–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
    ‚îú‚îÄ‚îÄ restic/              # ‚Üê –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Restic –¥–ª—è –æ–±–ª–∞—á–Ω—ã—Ö –±—ç–∫–∞–ø–æ–≤
    ‚îî‚îÄ‚îÄ caddy/               # ‚Üê TLS-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã Let's Encrypt + –∫—ç—à
```
> ‚úÖ –í—Å–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è, –≤–∫–ª—é—á–∞—è:
> - –ò—Å—Ç–æ—Ä–∏—é –∫–æ–º–º–∏—Ç–æ–≤ –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ Gitea 
> - –¢–æ–∫–µ–Ω —Ä–∞–Ω–Ω–µ—Ä–∞ (–Ω–µ –Ω—É–∂–Ω–æ –∑–∞–Ω–æ–≤–æ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å) 
> - –ë–∞–∑—É –ø–∞—Ä–æ–ª–µ–π Vaultwarden 
> - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é AdGuard Home
> - –°–∫–∞—á–∞–Ω–Ω—ã–µ —Ç–æ—Ä—Ä–µ–Ω—Ç—ã –∏ –º–µ–¥–∏–∞ 
> - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Restic –¥–ª—è –æ–±–ª–∞—á–Ω—ã—Ö –±—ç–∫–∞–ø–æ–≤
> - –î–µ–π—Å—Ç–≤—É—é—â–∏–µ TLS-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (–∏–∑–±–µ–≥–∞–µ–º –ª–∏–º–∏—Ç–æ–≤ Let's Encrypt –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏)

> üí° –û–±–ª–∞—á–Ω—ã–µ –±—ç–∫–∞–ø—ã (Restic) ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –∑–∞—â–∏—Ç—ã:
> - –°–æ–∑–¥–∞—é—Ç –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –±—ç–∫–∞–ø—ã –≤ –æ–±–ª–∞–∫–µ (S3, WebDAV, etc.)
> - –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã —á–µ—Ä–µ–∑ —Ñ–∞–π–ª—ã –≤ ~/infra/secrets/restic/
> - –†–∞–±–æ—Ç–∞—é—Ç –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é —á–µ—Ä–µ–∑ systemd.timer

üí° –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
```bash
# –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø
infra backup
# ‚Üê –∑–∞–ø—Ä–æ—Å–∏—Ç –ø–∞—Ä–æ–ª—å –¥–≤–∞–∂–¥—ã, —Å–æ–∑–¥–∞—Å—Ç ~/infra/backups/infra-backup-20260205-143022.tar.gz.gpg

# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ñ–ª–µ—à–∫—É
cp ~/infra/backups/infra-backup-*.tar.gz.gpg /usb/

# –ù–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ
./infra.sh --restore
cp /usb/infra-backup-*.tar.gz.gpg ~/infra/backups/
infra restore
# ‚Üê –∑–∞–ø—Ä–æ—Å–∏—Ç –ø–∞—Ä–æ–ª—å, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ, –∑–∞–ø—É—Å—Ç–∏—Ç —Å–µ—Ä–≤–∏—Å—ã

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
infra status

# –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
infra monitor

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏
infra update run        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
infra update apply      # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
```

> ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ v4:
> - –ê–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ podman-auto-update.timer
> - –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π healthcheck —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ –≤ Telegram
> - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–±–ª–∞—á–Ω—ã—Ö –±—ç–∫–∞–ø–æ–≤ —á–µ—Ä–µ–∑ Restic
> - –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π WireGuard VPN-—Å–µ—Ä–≤–µ—Ä
> - AdGuard Home –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ä–µ–∫–ª–∞–º—ã –∏ DNS-—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
> - –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

üìö –†–µ—Å—É—Ä—Å—ã 

[Quadlets (Podman)](https://docs.podman.io/en/latest/markdown/podman-systemd.unit.5.html?spm=a2ty_o01.29997173.0.0.213551718a05nT) \
[Podman auto-update](https://docs.podman.io/en/latest/markdown/podman-auto-update.1.html?spm=a2ty_o01.29997173.0.0.213551718a05nT) \
[Restic](https://restic.readthedocs.io/?spm=a2ty_o01.29997173.0.0.213551718a05nT) \
[WireGuard](https://www.wireguard.com/quickstart/?spm=a2ty_o01.29997173.0.0.213551718a05nT) \
[AdGuard Home](https://github.com/AdguardTeam/AdGuardHome/wiki?spm=a2ty_o01.29997173.0.0.213551718a05nT) \


> ‚ú® –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞–∫ –∫–æ–¥ ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ —Å–ª–æ–∂–Ω–æ—Å—Ç—å, –∞ –ø—Ä–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å.
